<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Shop CRUD</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { border-collapse: collapse; width: 100%; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        th { background-color: #f2f2f2; }
        input, button { padding: 5px; margin: 5px; }
    </style>
</head>
<body>
    <h1>Shop Products</h1>

    <h2>Add Product</h2>
    <input type="text" id="name" placeholder="Name">
    <input type="number" id="price" placeholder="Price">
    <input type="number" id="quantity" placeholder="Quantity">
    <input type="text" id="category" placeholder="Category">
    <button onclick="addProduct()">Add</button>

    <h2>Products List</h2>
    <table id="productsTable">
        <thead>
            <tr>
                <th>ID</th><th>Name</th><th>Price</th><th>Quantity</th><th>Category</th><th>Actions</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

<script>
const API_URL = "/products"; // Render будет использовать тот же хост

// --- Fetch products and show in table ---
async function fetchProducts() {
    try {
        const res = await fetch(API_URL);
        const products = await res.json();
        const tbody = document.querySelector("#productsTable tbody");
        tbody.innerHTML = "";
        products.forEach(p => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
                <td>${p.id}</td>
                <td>${p.name}</td>
                <td>${p.price}</td>
                <td>${p.quantity}</td>
                <td>${p.category || ""}</td>
                <td>
                    <button onclick="deleteProduct(${p.id})">Delete</button>
                </td>
            `;
            tbody.appendChild(tr);
        });
    } catch (err) {
        console.error("❌ Ошибка при получении продуктов:", err);
    }
}

// --- Add product ---
async function addProduct() {
    const name = document.getElementById("name").value;
    const price = parseFloat(document.getElementById("price").value);
    const quantity = parseInt(document.getElementById("quantity").value);
    const category = document.getElementById("category").value;

    try {
        await fetch(API_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name, price, quantity, category })
        });
        fetchProducts();
        document.getElementById("name").value = "";
        document.getElementById("price").value = "";
        document.getElementById("quantity").value = "";
        document.getElementById("category").value = "";
    } catch (err) {
        console.error("❌ Ошибка при добавлении продукта:", err);
    }
}

// --- Delete product ---
async function deleteProduct(id) {
    try {
        await fetch(`${API_URL}/${id}`, { method: "DELETE" });
        fetchProducts();
    } catch (err) {
        console.error("❌ Ошибка при удалении продукта:", err);
    }
}

// --- Initial load ---
fetchProducts();
</script>
</body>
</html>
